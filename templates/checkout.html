{% include 'indexnav.html' %}
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Checkout - Grocery Store</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: #f9f9f9;
            font-family: Arial, sans-serif;
            padding: 30px;
        }
        .card {
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .btn-checkout {
            background-color: #f5a623;
            border: none;
            color: white;
        }
        .btn-checkout:hover {
            background-color: #e69500;
        }
    </style>
</head>
<body>

<div class="container">
    <h2 class="mb-4 text-center">Checkout</h2>

    <div class="row g-4">
        <!-- Cart Summary -->
        <div class="col-md-6">
            <div class="card p-4">
                <h4 class="mb-3">Cart Summary</h4>
                <ul class="list-group">
                    {% for item in cart_items %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            {{ item.Product.Productname }} x{{ item.Quantity }}
                            <span>₹{{ item.Product.Productprice|floatformat:2 }}</span>
                        </li>
                    {% empty %}
                        <li class="list-group-item text-muted">Your cart is empty.</li>
                    {% endfor %}
                </ul>
                <hr>
                <h5 class="text-end">Total: ₹{{ total_price|floatformat:2 }}</h5>
            </div>
        </div>

        <!-- Address & Payment -->
        <div class="col-md-6">
            <div class="card p-4">
                <h4 class="mb-3">Shipping Details</h4>
                <form action="/save_order/" method="post" id="pay">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label class="form-label">Full Name</label>
                        <input type="text" class="form-control" name="Fullname" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Address</label>
                        <textarea class="form-control" name="Address" rows="3" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Phone Number</label>
                        <input type="text" class="form-control" name="Phonenumber" required>
                    </div>

                    <h4 class="mt-4">Payment Method</h4>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="Paymentmethod" id="cod" value="cod" checked>
                        <label class="form-check-label" for="cod">
                            Cash on Delivery (COD)
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="payment_method" id="online" value="online">
                        <label class="form-check-label" for="online">
                            Online Payment
                        </label>
                    </div>
                    <input type="hidden" name="order_id" value="{{razorpay_order_id}}">
                    <input type="hidden" name="payment_id" value="{{payment_id}}">

                    <button id="rzp-button1" type="submit" class="btn btn-checkout mt-4 w-100">Place Order</button>
                </form>
            </div>
        </div>
    </div>
</div>

</body>
<!-- Razorpay's Javascript code. -->

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>
    var options = {
        "key": "{{ razorpay_merchant_key }}", // Enter the Key ID generated from the Dashboard
        "amount": "{{ razorpay_amount }}", // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
        "currency": "{{ currency }}",
        "name": "test",
        "description": "Test Transaction",
        "image": "https://example.com/your_logo",
        "order_id": "{{razorpay_order_id}}", //This is a sample Order ID. Pass the id obtained in the response of Step 1
        "handler": function (response){
            $('#pay input[name=payment_id]').val(response.razorpay_payment_id)
            document.getElementById('pay').submit();
        },
        "prefill": {
            "name": "Your Name",
            "email": "youremail@gmail.com",
            "contact": "1234567890"
        },
        "notes": {
            "address": "Razorpay Corporate Office"
        },
        "theme": {
            "color": "rgb(104,222,238)"
        }
    };
    var rzp1 = new Razorpay(options);
    rzp1.on('payment.failed', function (response){
        $('#myModal').modal();
    });
    document.getElementById('rzp-button1').onclick = function(e){

        rzp1.open();
        e.preventDefault();
    }
</script>


</html>
